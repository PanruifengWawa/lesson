<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta charset='utf-8'>
    <meta name="keywords" content="">  
    <meta name="description" content="">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta content="telephone=no" name="format-detection">
    <title>课程章节</title>
    <link rel="stylesheet" type="text/css" href="assets/css/common.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/course_list.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/course_detail.css"/>
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?074a3ae03c67c779cac33a2a40e5d465";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </head>
  <body class="common" jet-form="content">
    <div id="forBg"></div>
    <div id="title" class="bold bg-w2">
      <div class="main-t" jet-name="name">name</div>
      <div class="small-t" jet-name="subName">subName</div>
      <img class="decr-img" src="assets/images/star.png" alt="" />
    </div>
    <div id="courseList" jet-name="content" jet-set="html">
      <!-- <div class="cl-item" onclick="toggleCourse(this)"> -->
        <!-- <img class="cl-i-img" src="assets/images/t_photo.png" alt="" /> -->
        <!-- <div class="cl-i-text m-intro-item bg-w2"> -->
          <!-- <div class="m-intro-head"></div> -->
          <!-- <div class="m-intro-text">测试测试测试测试</div> -->
        <!-- </div> -->
      <!-- </div> -->
      <!-- <div class="cl-lesson" > -->
        <!-- <div class="cl-l-w no-border"> -->
          <!-- <div class="cl-l-item m-intro-item bg-w3"> -->
            <!-- <div class="m-intro-head"></div> -->
            <!-- <div class="m-intro-text">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div> -->
          <!-- </div> -->
        <!-- </div> -->
        
        <!-- <div class="cl-l-w no-border"> -->
          <!-- <img class="cl-i-img" src="assets/images/t_photo.png" alt="" /> -->
          <!-- <div class="cl-l-item m-intro-item"> -->
            <!-- <div class="audio" onclick="toggleAudio(this)"> -->
              <!-- <audio src="assets/raw/test.mp3" preload="auto"></audio> -->
              <!-- <span class="audio-cur">00:00</span> / -->
              <!-- <span class="audio-all">00:00</span> -->
              <!-- <img class="audio-img" src="assets/images/audio.png"/> -->
            <!-- </div> -->
          <!-- </div> -->
        <!-- </div> -->
        
        <!-- <div class="cl-l-w no-border"> -->
          <!-- <img class="cl-i-img" src="assets/images/t_photo.png" alt="" /> -->
          <!-- <div class="cl-l-item m-intro-item"> -->
            <!-- <div class="audio" onclick="toggleAudio(this)"> -->
              <!-- <audio src="assets/raw/test.mp3" preload="auto"></audio> -->
              <!-- <span class="audio-cur">00:00</span> / -->
              <!-- <span class="audio-all">00:00</span> -->
              <!-- <img class="audio-img" src="assets/images/audio.png"/> -->
            <!-- </div> -->
          <!-- </div> -->
        <!-- </div> -->
        
        <!-- <div class="cl-l-w no-border"> -->
          <!-- <div class="cl-l-item m-intro-item bg-w3"> -->
            <!-- <div class="cl-l-single"> -->
              <!-- <div class="m-intro-head"></div> -->
              <!-- <div class="m-intro-text">测试测试测试测试测试测测试测试测试测试测测试测试</div> -->
            <!-- </div> -->
            <!-- <div class="cl-l-single"> -->
              <!-- <div class="m-intro-head"></div> -->
              <!-- <div class="m-intro-text">测试测试测试</div> -->
            <!-- </div> -->
            <!-- <div class="cl-l-single"> -->
              <!-- <div class="m-intro-head"></div> -->
              <!-- <div class="m-intro-text">测试测试测试</div> -->
            <!-- </div> -->
          <!-- </div> -->
        <!-- </div> -->
        
        <!-- <div class="cl-l-w no-border"> -->
          <!-- <div class="cl-l-item iv m-intro-item bg-w3"> -->
            <!-- <img class="l-img" src="assets/images/t_photo.png" alt="" /> -->
          <!-- </div> -->
        <!-- </div> -->
        
        <!-- <div class="cl-l-w no-border"> -->
          <!-- <div class="cl-l-item iv m-intro-item bg-w3"> -->
            <!-- <video class="l-video" controls src="assets/raw/test.mp4" ></video> -->
          <!-- </div> -->
        <!-- </div> -->
      <!-- </div> -->
      
    </div>
    
    <audio src="" id="playAudio"></audio>
    <div id="zoomImageCover" class="cover display-none">
      <div class="page">
        <div class="pinch-zoom">
          <img id="zoomImage" src=""/>
          <img id="zoomImageRep" class="" src="assets/images/audio.png"/>
        </div>
      </div>
      <!-- <img class="cover-close" src="assets/images/confirm_cancel.png" alt=""  onclick="closeZoom()"/> -->
    </div>
    
    <div id="footer">
      <div class="footer-item active" onclick="J.jump('course_main.html')">我的课程</div>
      <div class="footer-item" data-visit="true" onclick="J.jump('achieve.html')">我的成就</div>
      <div class="footer-item" data-visit="true" onclick="J.jump('user_center.html')">用户中心</div>
    </div>
    <script type="text/javascript" src="assets/js/jetter.min.js"></script>
    <script type="text/javascript" src="assets/js/bql.js"></script>
    <script type="text/javascript" src="assets/js/common.js"></script>
    <script type="text/javascript" src="assets/js/pinchzoom.js"></script>
    <script type="text/javascript">
      var params=urlParam().id.split("_");
      var id=params[0];
      var a_id=params[1];
      var c_id=params[2];
      var type=params[3];
      var isFree=params[4];
      var audioIndex=-1;
      var audios=[];
      var playAudio=J.id('playAudio');
      J.ready(function(){
        if(isFree!=0){
          setVisit();
        }
        loadContent();
        if(visit()){
          J.tag("title").txt("1000Books体验课");
        }
        J.id("title").findClass("decr-img").attr("src",getTypeImg(type));
        
      });
      function loadContent(){
        getData(null,"/course/"+id+"/arrangement/"+a_id+"/content/"+c_id,function(d){
          J.jetForm("content").set(d);
          J.class("cl-item").attr("onclick","toggleCourse(this)");
          J.class("l-img").addClass('zoom-img');
          initAudio();
          initPinch();
          checkHeadImgCenter();
        });
      }
      function toggleCourse(obj){
        var n=obj.next();
        if(n!=undefined){
          $(n).slideToggle();
        }
      }
      function initAudio(item){
        var list=J.tag("audio");
        if(list!=undefined&&list.length>0){
          list.each(function(item){
            if(item.attr('id')!='playAudio')
              item.onloadedmetadata=initAudioTime;
          });
        }
        J.tag("audio").each(function(a){
          if(a.attr('id')!='playAudio')
            audios.push(a.src);
        });
      }
      var t;
      function toggleAudio(obj){
        var same=false;
        var list=J.class("audio").toArray();
        for(var k=0;k<list.length;k++){
          if(list[k]==obj){
            if(audioIndex==k){
              same=true;
            }else{
              audioIndex=k;
            }
            break;
          }
        }
        if(same){
          if(playAudio.paused){
            playAudio.play();
            obj.findClass("audio-img").twinkle();
            t=setInterval(function(){
              resetAutoTime.call(playAudio,obj);
            },1000);
          }else{
            playAudio.pause();
            obj.findClass("audio-img").stopTwinkle(true);
            clearInterval(t);
          }
        }else{
          playNextAudio(obj);
        }
      }
      function playNextAudio(obj){
        playAudio.src=audios[audioIndex];
        playAudio.play();
        var active=J.select(".audio.active");
        if(active.exist()){
          active.removeClass('active').findClass("audio-cur").txt("0:00");
          active.findClass("audio-img").stopTwinkle(true);
          clearInterval(t);
        }
        obj.addClass('active');
        obj.findClass("audio-img").twinkle();
        t=setInterval(function(){
          resetAutoTime.call(playAudio,obj);
        },1000);
      }
      function initAudioTime(){
        var time=this.duration;
        if(isNaN(time)){
          time=0; 
        }
        var min=Math.floor(time/60);
        var sec=Math.round(time%60);
        if(sec<10){
          sec="0"+sec;
        }
        this.parent().findClass("audio-all").txt(min+":"+sec);
        if(min<10){
          this.parent().findClass("audio-cur").txt("0:00");
        }else{
          this.parent().findClass("audio-cur").txt("00:00");
        }
      }
      
      function resetAutoTime(obj){
        var time=this.currentTime;
        if(time>=this.duration){
          //this.parent().findClass("audio-img").stopTwinkle(true);
          clearInterval(t);
          var list=J.class("audio").toArray();
          list[audioIndex].findClass("audio-cur").txt("0:00");
          list[audioIndex].findClass("audio-img").stopTwinkle(true);
          if(audioIndex>=list.length-1){
            audioIndex=0;
          }else{
            audioIndex++;
          }
          playNextAudio(list[audioIndex]);
          J.show("正在自动播放下一音频...");
        }else{
          var min=Math.floor(time/60);
          var sec=Math.round(time%60);
          if(sec<10){
            sec="0"+sec;
          }
          if(sec.toString()=="NaN"){
            sec="00";
          }
          obj.findClass("audio-cur").txt(min+":"+sec);
        
          time=this.duration;
          if(time.toString()=="NaN"){
            time=0;
          }
          var min=Math.floor(time/60);
          var sec=Math.round(time%60);
          if(sec<10){
            sec="0"+sec;
          }
          obj.findClass("audio-all").txt(min+":"+sec);
        }
      }
      function getTypeImg(type){
        var img="assets/images/";
        switch(parseInt(type)){
          case 3:img+="star.png";break;
          case 2:img+="moon.png";break;
          case 1:img+="sun.png";break;
          case 4:img+="cup.png";break;
          default:;break;
        }
        return img;
      }
      function checkHeadImgCenter(){
        J.class("cl-i-img").each(function(item){
          var h=item.next().hei();
          if(h>43){
            item.css("top","+="+((h-40)/2)+"px");
          }
        });
      }
      window.onresize=function(){
        checkForBg();
        if(show_img!=null){
          bindZoom(show_img);
        }
      };
    </script>
  </body>
</html>
