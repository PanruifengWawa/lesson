<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta charset='utf-8'>
    <meta name="keywords" content="">  
    <meta name="description" content="">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta content="telephone=no" name="format-detection">
    <title>编辑课程内容</title>
    <link rel="stylesheet" type="text/css" href="assets/css/m_common.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/m_course_list.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/m_course_detail.css"/>
    
    <link rel="stylesheet" type="text/css" href="assets/css/common.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/course_main.css"/>
  </head>
  <body>
    <div class="head">
      <div class="c-w">
        <span class="head-title">小芝妈咪后台管理系统</span>
        <div id="userName"><span class="glyphicon glyphicon-user"></span><span id="adminName">用户</span></div>
        <div id="logout" class="c-btn bg-r" onclick="logout()">退出登录</div>
      </div>
    </div>
    <div class="body clearfix">
      <div class="main-left">
        <div class="index-item active" onclick="J.jump('course_main.html')"><span class="glyphicon glyphicon-book"></span>课 程 管 理</div>
        <div class="index-item" onclick="J.jump('user.html')"><span class="glyphicon glyphicon-user"></span>用 户 管 理</div>
        <div class="index-item" onclick="J.jump('code.html')"><span class="glyphicon glyphicon-th"></span>激活码管理</div>
        <div class="index-item" onclick="J.jump('book_link.html')"><span class="glyphicon glyphicon-link"></span>1000Books</div>
        <div class="index-item" onclick="J.jump('mod_info.html')"><span class="glyphicon glyphicon-lock"></span>修 改 密 码</div>
      </div>
      <div class="main-right">
        <div class="main-title">课程管理 &gt; 课程安排 &gt; 章节管理 &gt; 课程内容详情 <div class="c-btn" onclick="J.back()">返回上一级</div> </div>
        <div class="clearfix">
          <div class="content-info" jet-form="contentInfo">
            <div class="bold fs-3 m-2 t-left ml-n">课程章节信息</div>
            <div class="m-3 t-left">主标题：<input type="text" jet-name="name" jet-valid="notnull" disabled class="c-input course" value="星星课程1"/></div>
            <div class="m-3 t-left">副标题：<input type="text" jet-name="subName" jet-valid="notnull" disabled class="c-input course" value="星星课程1"/></div>
            
            <div class="btn-w">
              <div class="c-btn" onclick="toggleSave(this)">修改信息</div>
              <div class="c-btn bg-r" onclick="deleteCourseCha()">删除该节</div>
            </div>
          </div>
          <div class="content cl clearfix relative">
            <div class="bold fs-3 m-2 t-left ml-n">该章节的内容</div>
            <div class="tool-box">
              <div class="c-btn" onclick="addElement('title')">添加标题</div>
              <div class="c-btn" onclick="addElement('text')">添加文本</div>
              <div class="c-btn" onclick="addElement('long')">添加长文本</div>
              <div class="c-btn" onclick="addElement('image')">添加图片</div>
              <div class="c-btn" onclick="addElement('audio')">添加音频</div>
              <div class="c-btn" onclick="addElement('video')">添加视频</div>
              <div class="c-btn bg-b" onclick="toggleView(this)">预览</div>
              <div class="c-btn bg-r" onclick="clearDetail()">清空内容</div>
              <div class="c-btn bg-b" onclick="resetDetail()">还原内容</div>
              <div class="c-btn bg-b" onclick="saveDetail(this)">保存</div>
            </div>
            
            <div class="view-area">
            
              <div id="title" class="bold bg-w2">
                <div class="main-t">Lesson1</div>
                <div class="small-t">test test test test test</div>
                <img class="decr-img" src="assets/images/star.png" alt="" />
              </div>
              <div id="courseList">
                <!--<div class="cl-item">
                  <img class="cl-i-img" src="assets/images/t_photo.png" alt="" />
                  <div class="cl-i-text m-intro-item bg-w2">
                    <div class="m-intro-head"></div>
                    <div class="m-intro-text">测试测试测试测试</div>
                  </div>
                  <div class="func-w">
                    <div class="c-btn" onclick="this.child(0).fadeToggle()">插入
                      <div class="tool-box">
                        <div class="c-btn">标题</div>
                        <div class="c-btn">文本</div>
                        <div class="c-btn">图片</div>
                        <div class="c-btn">音频</div>
                        <div class="c-btn">视频</div>
                      </div>
                    </div>
                    <div class="c-btn bg-r" onclick="confirmDeleteEle(this)">删除</div>
                  </div>
                </div>
                <div class="cl-lesson">
                  <div class="cl-l-w no-border">
                    <div class="cl-l-item m-intro-item bg-w3">
                      <div class="m-intro-head"></div>
                      <div class="m-intro-text">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                    </div>
                    <div class="func-w">
                      <div class="c-btn" onclick="this.child(0).fadeToggle()">插入
                        <div class="tool-box">
                          <div class="c-btn">标题</div>
                          <div class="c-btn">文本</div>
                          <div class="c-btn">图片</div>
                          <div class="c-btn">音频</div>
                          <div class="c-btn">视频</div>
                        </div>
                      </div>
                      <div class="c-btn bg-r">删除</div>
                    </div>
                  </div>
                  
                  <div class="cl-l-w no-border">
                    <img class="cl-i-img" src="assets/images/t_photo.png" alt="" />
                    <div class="cl-l-item m-intro-item">
                      <div class="audio" onclick="toggleAudio(this)">
                        <audio src="assets/raw/test.mp3" preload="auto"></audio>
                        <span class="audio-cur">00:00</span> /
                        <span class="audio-all">00:00</span>
                        <img class="audio-img" src="assets/images/audio.png"/>
                      </div>
                    </div>
                    <div class="func-w">
                      <div class="c-btn" onclick="this.child(0).fadeToggle()">插入
                        <div class="tool-box">
                          <div class="c-btn">标题</div>
                          <div class="c-btn">文本</div>
                          <div class="c-btn">图片</div>
                          <div class="c-btn">音频</div>
                          <div class="c-btn">视频</div>
                        </div>
                      </div>
                      <div class="c-btn bg-r">删除</div>
                    </div>
                  </div>
                  
                  <div class="cl-l-w no-border">
                    <img class="cl-i-img" src="assets/images/t_photo.png" alt="" />
                    <div class="cl-l-item m-intro-item">
                      <div class="audio" onclick="toggleAudio(this)">
                        <audio id="aaa" src="assets/raw/test.mp3" preload="auto"></audio>
                        <span class="audio-cur">00:00</span> /
                        <span class="audio-all">00:00</span>
                        <img class="audio-img" src="assets/images/audio.png"/>
                      </div>
                    </div>
                    <div class="func-w">
                      <div class="c-btn" onclick="this.child(0).fadeToggle()">插入
                        <div class="tool-box">
                          <div class="c-btn">标题</div>
                          <div class="c-btn">文本</div>
                          <div class="c-btn">图片</div>
                          <div class="c-btn">音频</div>
                          <div class="c-btn">视频</div>
                        </div>
                      </div>
                      <div class="c-btn bg-r">删除</div>
                    </div>
                  </div>
                  
                  <div class="cl-l-w no-border">
                    <div class="cl-l-item m-intro-item bg-w3">
                      <div class="cl-l-single">
                        <div class="m-intro-head"></div>
                        <div class="m-intro-text">测试测试测试测试测试测测试测试测试测试测测试测试</div>
                      </div>
                      <div class="cl-l-single">
                        <div class="m-intro-head"></div>
                        <div class="m-intro-text">测试测试测试</div>
                      </div>
                      <div class="cl-l-single">
                        <div class="m-intro-head"></div>
                        <div class="m-intro-text">测试测试测试</div>
                      </div>
                    </div>
                    <div class="func-w">
                      <div class="c-btn" onclick="this.child(0).fadeToggle()">插入
                        <div class="tool-box">
                          <div class="c-btn">标题</div>
                          <div class="c-btn">文本</div>
                          <div class="c-btn">图片</div>
                          <div class="c-btn">音频</div>
                          <div class="c-btn">视频</div>
                        </div>
                      </div>
                      <div class="c-btn bg-r">删除</div>
                    </div>
                  </div>
                  
                  <div class="cl-l-w no-border">
                    <div class="cl-l-item iv m-intro-item bg-w3">
                      <img class="l-img" src="assets/images/t_photo.png" alt="" />
                    </div>
                    <div class="func-w">
                      <div class="c-btn" onclick="this.child(0).fadeToggle()">插入
                        <div class="tool-box">
                          <div class="c-btn">标题</div>
                          <div class="c-btn">文本</div>
                          <div class="c-btn">图片</div>
                          <div class="c-btn">音频</div>
                          <div class="c-btn">视频</div>
                        </div>
                      </div>
                      <div class="c-btn bg-r">删除</div>
                    </div>
                  </div>
                  
                  <div class="cl-l-w no-border">
                    <div class="cl-l-item iv m-intro-item bg-w3">
                      <video class="l-video" controls src="assets/raw/test.mp4" ></video>
                    </div>
                    <div class="func-w">
                      <div class="c-btn" onclick="this.child(0).fadeToggle()">插入
                        <div class="tool-box">
                          <div class="c-btn">标题</div>
                          <div class="c-btn">文本</div>
                          <div class="c-btn">图片</div>
                          <div class="c-btn">音频</div>
                          <div class="c-btn">视频</div>
                        </div>
                      </div>
                      <div class="c-btn bg-r">删除</div>
                    </div>
                  </div>
                </div>-->
                
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
    <div id="addWrapper" class="hide">
      <div class="add-box">
        <div id="addTitle" class="a-title">添加小标题</div>
        <div jet-form="addtitle">
          <div class="a-item">
            上传头像：
            <input type="file" id="file" jet-name="src" jet-valid="notnull" class="c-input"/>
          </div>
          <div class="a-item">
            输入名称：<input type="text" jet-name="text" jet-valid="notnull" class="c-input"/>
          </div>
          <div class="a-item">
            添加小点：
            <select jet-name="needCircle" jet-valid="notnull" class="c-input">
              <option value="true">添加</option>
              <option value="false">不添加</option>
            </select>
          </div>
          <div class="a-item">
            对齐方式：
            <select jet-name="align" jet-valid="notnull" class="c-input">
              <option value="tleft">向左对齐</option>
              <option value="tcenter">居中对齐</option>
              <option value="tright">向右对齐</option>
            </select>
          </div>
        </div>
        <div jet-form="addtext">
          <div class="a-item">
            <span class="textarea-text">输入文字：</span>
            <textarea jet-name="text" jet-valid="notnull" class="c-input"></textarea>
          </div>
          <div class="a-item">
            添加小点：
            <select jet-name="needCircle" jet-valid="notnull" class="c-input">
              <option value="true">添加</option>
              <option value="false">不添加</option>
            </select>
          </div>
          <div class="a-item">
            对齐方式：
            <select jet-name="align" jet-valid="notnull" class="c-input">
              <option value="tleft">向左对齐</option>
              <option value="tcenter">居中对齐</option>
              <option value="tright">向右对齐</option>
            </select>
          </div>
        </div>
        <div jet-form="addlong">
          <div class="a-item">
            <span class="textarea-text">输入长文：</span>
            <textarea jet-name="text" jet-valid="notnull" class="c-input"></textarea>
          </div>
          <div class="a-item">
            添加小点：
            <select jet-name="needCircle" jet-valid="notnull" class="c-input">
              <option value="true">添加</option>
              <option value="false">不添加</option>
            </select>
          </div>
          <div class="a-item">
            对齐方式：
            <select jet-name="align" jet-valid="notnull" class="c-input">
              <option value="tleft">向左对齐</option>
              <option value="tcenter">居中对齐</option>
              <option value="tright">向右对齐</option>
            </select>
          </div>
        </div>
        <div jet-form="addimage">
          <div class="a-item">
            上传图片：<input type="file" id="photoFile" jet-name="src" jet-valid="notnull" class="c-input"/>
          </div>
        </div>
        <div jet-form="addaudio">
          <div class="a-item">
            上传头像：<input type="file" id="audioImgFile" jet-name="src" jet-valid="notnull" class="c-input"/>
          </div>
          <div class="a-item">
            上传音频：<input type="file" id="audioFile" jet-name="audio" jet-valid="notnull" class="c-input"/>
          </div>
        </div>
        <div jet-form="addvideo">
          <div class="a-item">
            上传视频：
            <input type="file" id="videoFile" jet-name="video" jet-valid="notnull" class="c-input"/>
          </div>
        </div>
        <div class="a-item">
          <div class="c-btn" id="addBtn">确认添加</div>
          <div class="c-btn bg-r" onclick="closeAdd()">取消</div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="assets/js/jetter.min.js"></script>
    <script type="text/javascript" src="assets/js/bql.js"></script>
    <script type="text/javascript" src="assets/js/common.js"></script>
    <script type="text/javascript" src="assets/js/login.js"></script>
    <script type="text/javascript">
      
      var id=J.urlParam().split('_')[0];
      var a_id=J.urlParam().split('_')[1];
      var c_id=J.urlParam().split('_')[2];
      var resetHtml;
      J.ready(function(){
        getData(null,"/course/"+id+"/arrangement/"+a_id+"/content/"+c_id,function(d){
          J.jetForm("contentInfo").set(d);
          J.id("courseList").html(d.content);
          initList();
          J.id("title").child(0).txt(d.name);
          J.id("title").child(1).txt(d.subName);
          resetHtml=J.id("courseList").html();
          J.tag("video").attr("poster",def_img);
          initAudio();
        });
      });
      function initList(){
        J.class("cl-lesson").each(function(item){
          item.after(item.child().allHtml()).remove();
        });
        J.class("cl-item").each(function(item){
          item.append(geneFunw());
        });
        J.class("cl-l-w").each(function(item){
          item.append(geneFunw());
        });
        J.class("m-intro-text").attr("contenteditable","true");
      }
      function confirmDeleteEle(obj){
        J.confirm('是否确认删除上一个元素(不可撤销)？',function(){
          obj.parent(2).fadeOut(function(){
            obj.parent(2).remove();
          });
        })
      }
      function addElement(type,i){//有obj为插入
        var name=getName(type);
        showAdd("添加"+name,"add"+type,function(data,obj){
          switch(type){
            case "title":upload(function(src){
              data.src=src;
              addTitle(data,i);
              closeAdd();
              edit();
            },"file");break; 
            case "text":addText(data,i);closeAdd();edit();break; 
            case "long":addLong(data,i);closeAdd();edit();break; 
            case "image":upload(function(src){
              data.src=src;
              addImage(data,i);
              closeAdd();
              edit();
            },"photoFile");break; 
            case "audio":upload(function(src){
              data.src=src;
              upload(function(audio){
                data.audio=audio;
                addAudio(data,i);
                closeAdd();
                edit();
              },"audioFile");
            },"audioImgFile");break; 
            case "video":upload(function(video){
              data.video=video;
              addVideo(data,i);
              closeAdd();
              edit();
            },"videoFile");break; 
          }
        });
      }
      function getName(type){
        var name="";
        switch(type){
          case "title":name="标题";break; 
          case "text":name="文字";break; 
          case "long":name="长文本";break; 
          case "image":name="图片";break; 
          case "audio":name="音频";break; 
          case "video":name="视频";break; 
        }
        return name;
      }
      var src="assets/images/t_photo.png";
      var text="测试测试";
      var audio="assets/raw/test.mp3";
      var video="assets/raw/test.mp4";
      var text="测试测试";
      function addTitle(data,i){
        var no_c=(data.needCircle=="true")?"":"no-circle";
        var item=J.new("div.cl-item").html('\
                <img class="cl-i-img" src="'+data.src+'" alt="" />\
                <div class="cl-i-text m-intro-item bg-w2">\
                  <div class="m-intro-head '+no_c+'"></div>\
                  <div class="m-intro-text '+data.align+'" contenteditable="true">'+data.text+'</div>\
                </div>').append(geneFunw());
        J.id("courseList").append(item,i);
      }
      function addText(data,i){
        var no_c=(data.needCircle=="true")?"":"no-circle";
        var texts=data.text.split("\n");
        var html='<div class="cl-l-item m-intro-item bg-w3">';
        texts.each(function(text){
          html+='<div class="cl-l-single">\
            <div class="m-intro-head '+no_c+'"></div>\
            <div class="m-intro-text '+data.align+'" contenteditable="true">'+text+'</div>\
          </div>';
        });
        var item=J.new("div.cl-l-w.no-border").html(html).append(geneFunw());
        J.id("courseList").append(item,i);
      }
      function addLong(data,align,needCircle,i){
        var no_c=(data.needCircle=="true")?"":"no-circle";
        var texts=data.text.split("\n");
        var html='<div class="cl-l-item fix m-intro-item bg-w3">';
        texts.each(function(text){
          html+='<div class="cl-l-single">\
            <div class="m-intro-head '+no_c+'"></div>\
            <div class="m-intro-text '+data.align+'" contenteditable="true">'+text+'</div>\
          </div>';
        });
        var item=J.new("div.cl-l-w.no-border").html(html).append(geneFunw());
        J.id("courseList").append(item,i);
      }
      function addImage(data,i){
        var item=J.new("div.cl-l-w.no-border").html('\
                <div class="cl-l-item iv m-intro-item bg-w3">\
                  <img class="l-img" src="'+data.src+'" alt="" />\
                </div>').append(geneFunw());
        J.id("courseList").append(item,i);
      }
      function addAudio(data,i){
        var item=J.new("div.cl-l-w.no-border").html('\
                <img class="cl-i-img" src="'+data.src+'" alt="" />\
                <div class="cl-l-item m-intro-item">\
                  <div class="audio" onclick="toggleAudio(this)">\
                    <audio src="'+data.audio+'" preload="auto"></audio>\
                    <span class="audio-cur">00:00</span> /\
                    <span class="audio-all">00:00</span>\
                    <img class="audio-img" src="assets/images/audio.png"/>\
                  </div>\
                </div>').append(geneFunw());
        J.id("courseList").append(item,i);
        initAudio();
      }
      function addVideo(data,i){
        var item=J.new("div.cl-l-w.no-border").html('\
                <div class="cl-l-item iv m-intro-item bg-w3">\
                  <video class="l-video" controls src="'+data.video+'" poster="assets/images/u_photo_def.png"></video>\
                </div>').append(geneFunw());
        J.id("courseList").append(item,i);
      }
      var insertIndex=-1;
      function parpreEle(type,obj){
        insertIndex=obj.parent(4).index()+1;
        addElement(type,insertIndex);
      }
      function geneFunw(){
        return J.new("div.func-w").html('\
            <div class="c-btn" onclick="moveUp(this)">上移</div>\
            <div class="c-btn" onclick="moveDown(this)">下移</div>\
            <div class="c-btn" onclick="this.child(0).fadeToggle()">插入\
              <div class="tool-box">\
                <div class="c-btn" onclick="parpreEle(\'title\',this)">标题</div>\
                <div class="c-btn" onclick="parpreEle(\'text\',this)">文本</div>\
                <div class="c-btn" onclick="parpreEle(\'long\',this)">长文</div>\
                <div class="c-btn" onclick="parpreEle(\'image\',this)">图片</div>\
                <div class="c-btn" onclick="parpreEle(\'audio\',this)">音频</div>\
                <div class="c-btn" onclick="parpreEle(\'video\',this)">视频</div>\
              </div>\
            </div>\
            <div class="c-btn bg-r" onclick="confirmDeleteEle(this)">删除</div>');
      }
      function moveUp(obj){
        move("up",obj);
      }
      function moveDown(obj){
        move("down",obj);
      }
      function move(type,obj){
        var ele=obj.parent(2);
        var i=ele.index();
        var n=J.id("courseList").child().length;
        if(i==0&&type=="up"){
          J.show("当前元素已是第一个元素","error");
          return;
        }
        if(i==n-1&&type=="down"){
          J.show("当前元素已是最后一个元素","error");
          return;
        }
        var clone=ele.clone();
        clone.css("display","none!important");
        if(type=="up"){
          ele.prev().before(clone);
        }else{
          ele.next().after(clone);
        }
        ele.fadeOut(function(){
          ele.remove();
          clone.fadeIn();
        })
      }
      function clearDetail(){
        J.confirm('是否确认删除所有元素(不可撤销)？',function(){
          J.id("courseList").child().fadeOut();
          setTimeout(function(){
            J.id("courseList").empty();
          },500);
        })
      }
      function saveDetail(obj){
        if(obj.txt()=="保存"){
          var html=geneCourseHtml();
          if(html!=false){
            obj.txt("保存中...");
            postData({content:html},"/course/"+id+"/arrangement/"+a_id+"/content/"+c_id,function(d){
              J.show("保存成功");
              resetHtml=J.id("courseList").html();
              obj.txt("保存");
              editDone();
            },true,function(){
              obj.txt("保存");
            });
          }
        }
      }
      function resetDetail(){
        J.confirm('是否确认还原课程内容(当前编辑内容会被覆盖且无法撤销)？',function(){
          J.id("courseList").html(resetHtml);
          J.show("还原成功");
        });
      }
      function geneCourseHtml(){
        var ele=J.id("courseList");
        var list=ele.child();
        if(list.length==0){
          J.show("请先添加课程元素","error");
          return false;
        }
        if(!list.first().hasClass("cl-item")){
          J.show("第一个元素必须是标题","error");
          return false;
        }
        if(list.last().hasClass("cl-item")){
          J.show("最后一个元素不能是标题","error");
          return false;
        }
        var n=list.length;
        var html="";
        list.each(function(item,i){
          if(item.hasClass("cl-item")){
            if(i==0){
              html+=(item.allHtml()+'<div class="cl-lesson">');
            }else{
              html+=("</div>"+item.allHtml()+'<div class="cl-lesson">');
            }
          }else{
            html+=item.allHtml();
          }
        });
        html+="</div>";
        var a=J.new("div").html(html);
        a.findClass("func-w").remove();
        a.findClass("m-intro-text").removeAttr("contenteditable");
        a.findClass("audio").each(function(item){
          item.child(1).txt("00:00");
          item.child(2).txt("00:00");
          item.child(3).stopTwinkle();
        });
        return a.html();
      }
      function toggleView(obj){
        if(obj.txt()=="预览"){
          J.class('func-w').fadeOut();
          obj.txt("还原");
        }else{
          J.class('func-w').fadeIn();
          obj.txt("预览");
        }
      }
      function initAudio(item){
        if(item==undefined){
          var list=J.tag("audio");
          if(list!=undefined&&list.length>0){
            list.each(function(item){
              initAudio(item)
            });
          }
        }else{
          initAudioTime(item);
          if(item.onloadedmetadata===undefined){
            item._t=setInterval(function(){
              inter(item);
            },100);
          }else{
            item.onloadedmetadata=function(){initAudioTime(item)}
          }
        }
      }
      
      function saveInfo(call,obj){
        J.jetForm("contentInfo").validate(function(data){
          J.showWait("正在保存...");
          postData(data,"/course/"+id+"/arrangement/"+a_id+"/content/"+c_id,function(d){
            J.show("保存成功");
            J.id("title").child(0).txt(data.name);
            J.id("title").child(1).txt(data.subName);
            call();
          },true,function(){
            obj.txt("修改信息");
          });
        });
      }
      function toggleSave(obj){
        var par=obj.parent(2);
        if(obj.txt()=="修改信息"){
          undisable(par);
          obj.txt("保存");
          edit();
        }else if(obj.txt()=="保存"){
          saveInfo(function(){
            disable(par);
            obj.txt("修改信息");
            editDone();
          },obj);
        }
      }
      function deleteCourseCha(){
        doubleConfirm("是否确认删除该节？","该操作不可撤销，是否继续？",function(){
          J.show("正在删除...");
          deleteData("/course/"+id+"/arrangement/"+a_id+"/content/"+c_id,function(){
            J.show("删除成功，即将返回上一级..")
            delay('J.back()');
          });
        });
      }
      
      
      var timer,t;
      var update=true;
      function inter(item){
        if(item.duration.toString()!="NaN"){
          initAudioTime(item);
          clearInterval(item._t);
          item._t=undefined;
        }
      }
      function toggleAudio(obj){
        var audio=obj.findTag("audio");
        if(audio.paused){
          inactiveAudio();
          audio.addClass("active").play();
          obj.findClass("audio-img").twinkle();
          t=setInterval(function(){
            resetAutoTime.call(audio);
          },1000);
        }else{
          clearInterval(t);
          audio.removeClass("active").pause();
          obj.findClass("audio-img").stopTwinkle(true);
        }
      }
      function inactiveAudio(){
        var obj=J.select("audio.active");
        if(obj.length!=0){
          obj.removeClass("active").pause();
          obj.currentTime=0;
          obj.parent().findClass("audio-cur").txt("0:00");
          obj.parent().findClass("audio-img").stopTwinkle(true);
        }
        //onloadedmetadata ="initAudioTime(this)" timeupdate="resetAutoTime(this)"
      }
      function initAudioTime(obj){
        var time=obj.duration;
        if(time.toString()=="NaN"){
          time=0;
        }
        var min=Math.floor(time/60);
        var sec=Math.round(time%60);
        if(sec<10){
          sec="0"+sec;
        }
        obj.parent().findClass("audio-all").txt(min+":"+sec);
        if(min<10){
          obj.parent().findClass("audio-cur").txt("0:00");
        }else{
          obj.parent().findClass("audio-cur").txt("00:00");
        }
        //if(obj.ontimeupdate!==undefined){
        //  obj.ontimeupdate = resetAutoTime;
        //}else{
          update=false;
        //}
      }
      function resetAutoTime(){
        var time=this.currentTime;
        if(time+1>=this.duration){
          this.parent().findClass("audio-img").stopTwinkle(true);
        }
        var min=Math.floor(time/60);
        var sec=Math.round(time%60);
        if(sec<10){
          sec="0"+sec;
        }
        if(sec.toString()=="NaN"){
          sec="00";
        }
        this.parent().findClass("audio-cur").txt(min+":"+sec);
        
        if(this.data("set_d")!=true){
          this.data("set_d",true);
          time=this.duration;
          if(time.toString()=="NaN"){
            time=60;
          }
          var min=Math.floor(time/60);
          var sec=Math.round(time%60);
          this.parent().findClass("audio-all").txt(min+":"+sec);
        }
      }
    </script>
  </body>
</html>
