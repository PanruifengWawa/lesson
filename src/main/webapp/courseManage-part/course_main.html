<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta charset='utf-8'>
    <meta name="keywords" content="">  
    <meta name="description" content="">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta content="telephone=no" name="format-detection">
    <title>课程管理</title>
    <link rel="stylesheet" type="text/css" href="assets/css/common.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/course_main.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/page.css"/>
  </head>
  <body>
    <div class="head">
      <div class="c-w">
        <span class="head-title">小芝妈咪后台管理系统</span>
        <div id="userName"><span class="glyphicon glyphicon-user"></span><span id="adminName">用户</span></div>
        <div id="logout" class="c-btn bg-r" onclick="logout()">退出登录</div>
      </div>
    </div>
    <div class="body clearfix">
      <div class="main-left">
        <div class="index-item active"><span class="glyphicon glyphicon-book"></span>课 程 管 理</div>
        <div class="index-item" onclick="J.jump('user.html')"><span class="glyphicon glyphicon-user"></span>用 户 管 理</div>
        <div class="index-item" onclick="J.jump('code.html')"><span class="glyphicon glyphicon-th"></span>激活码管理</div>
        <div class="index-item" onclick="J.jump('book_link.html')"><span class="glyphicon glyphicon-link"></span>1000Books</div>
        <div class="index-item" onclick="J.jump('mod_info.html')"><span class="glyphicon glyphicon-lock"></span>修 改 密 码</div>
      </div>
      <div class="main-right">
        <div class="main-title">课程管理</div>
        
        <div class="type-item">
          <div class="main-title no-border"> <!-- b-callback="setBgImg(this,'d{$each.imgSrc}d')"              d{($each.imgSrc=='imgSrc')?"style=&apos;background-image:url(&apos;$each.imgSrc&apos;)&apos;": ""}d -->
            <span>星星课程</span>
            <div class="c-btn xl" onclick="addCourseMain('star')">
              <span class="glyphicon glyphicon-plus"></span>添加星星课程
            </div>
          </div>
          <div class="p-1 clearfix" id="starList">
          
          </div>
        </div>
        
        <!-- <div class="course-item add" onclick="addCourseMain('star')"> -->
          <!-- <span class="glyphicon glyphicon-plus"> </span> -->
        <!-- </div> -->
        <div class="type-item">
          <div class="main-title no-border">
            <span>月亮课程</span>
            <div class="c-btn large" onclick="addCourseMain('moon')">
              <span class="glyphicon glyphicon-plus"></span>添加月亮课程
            </div>
          </div>
          <div class="p-1 clearfix" id="moonList">
          
          </div>
        </div>
        
        <div class="type-item">
          <div class="main-title no-border">
            <span>太阳课程</span>
            <div class="c-btn large" onclick="addCourseMain('sun')">
              <span class="glyphicon glyphicon-plus"></span>添加太阳课程
            </div>
          </div>
          <div class="p-1 clearfix" id="sunList">
            
          </div>
        </div>
        
        <div class="type-item">
          <div class="main-title no-border">
            <span>自然拼读等专项课程</span>
            <div class="c-btn large" onclick="addCourseMain('other')">
              <span class="glyphicon glyphicon-plus"></span>添加专项课程
            </div>
          </div>
          <div class="p-1 clearfix" id="otherList">
            
          </div>
        </div>
        
      </div>
    </div>
    <div id="addWrapper" class="">
      <div class="add-box">
        <div id="addTitle" class="a-title">添加小标题</div>
        <div jet-form="addCourse">
          <div class="a-item">
            上传封面：
            <input type="file" id="file" jet-name="imgSrc" jet-valid="notnull" class="c-input"/>
          </div>
          <div class="a-item">
            输入名称：<input type="text" jet-name="name" jet-valid="lengthOfAny[1,10]" class="c-input"/>
          </div>
          <div class="a-item">
            课程类型：<input type="text" disabled jet-valid="notnull" jet-name="type" class="c-input"/>
          </div>
          <div class="a-item">
            收费类型：
            <select jet-name="isFree" jet-valid="notnull" class="c-input">
              <option value="0">收费课</option>
              <option value="1">公开课</option>
            </select>
          </div>
          <div class="a-item">
            微店地址：<input type="text" jet-name="link" class="c-input"/>
          </div>
        </div>
        <!-- <form jet-form="add"> -->
          <!-- <div class="a-item"> -->
            <!-- 添加文字：<input type="text" class="c-input"/> -->
          <!-- </div> -->
          <!-- <div class="a-item"> -->
            <!-- 下拉选项： -->
            <!-- <select type="text" class="c-input"> -->
              <!-- <option value="0">收费课</option> -->
              <!-- <option value="1">公开课</option> -->
            <!-- </select> -->
          <!-- </div> -->
          <!-- <div class="a-item"> -->
            <!-- 添加文字： -->
            <!-- <select class="c-input"> -->
              <!-- <option value="">星星课程</option> -->
              <!-- <option value="">月亮课程</option> -->
              <!-- <option value="">太阳课程</option> -->
            <!-- </select> -->
          <!-- </div> -->
          <!-- <div class="a-item"> -->
            <!-- 上传图片：<input type="file" class="c-input"/> -->
          <!-- </div> -->
          <!-- <div class="a-item"> -->
            <!-- 上传音频：<input type="file" class="c-input"/> -->
          <!-- </div> -->
          <!-- <div class="a-item"> -->
            <!-- 上传视频：<input type="file" class="c-input"/> -->
          <!-- </div> -->
        <!-- </form> -->
        <div class="a-item">
          <div class="c-btn" id="addBtn">确认添加</div>
          <div class="c-btn bg-r" onclick="closeAdd()">取消</div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="assets/js/jetter.min.js"></script>
    <script type="text/javascript" src="assets/js/bql.js"></script>
    <script type="text/javascript" src="assets/js/common.js"></script>
    <script type="text/javascript" src="assets/js/login.js"></script>
    <script type="text/javascript" src="assets/js/page.js"></script>
    <script type="text/javascript">
    var types=["star","moon","sun","other"];
    J.ready(function(){
      types.each(function(item){
        BQL.init(J.id(item+"List").html(getCommHtml(item)).findAttr("b-loop"));
        loadSingleTypeCourse(item);
      });
    });
    function getCommHtml(type){
      return '<div class="page-wrapper">\
              <div class="page-bar" b-loop="'+type+'"  b-callback="genePage(this)">\
                <div class="c-wrapper page-item clearfix">\
                  $(each){\
                    <div class="course-item" style="background-image:url(\'d{$each.imgSrc}d\')" onclick="J.jump(\'course_list.html?id=d{$each.courseId}d\')">\
                      <div class="hide">d{$each.courseId}d</div>\
                      <div class="course-introd{($each.isFree==1)?" free":""}d">\
                        <div>类型：d{($each.isFree==1)?"公开课":"收费课"}d</div>\
                        <div>名称：d{$each.name}d</div>\
                        <div class="c-btn bg-r" onclick="deleteCourse(event,this)">删除</div>\
                      </div>\
                    </div>\
                  }$\
                </div>\
              </div>\
            </div>'
    }
    function setBgImg(obj,src){
      if(src=="imgSrc"){
        src=def_img;
      }
      obj.css("background-image","url('"+src+"')");
    }
    function genePage(obj){
      <!-- J.class("page-bar").each(function(item){ -->
        <!-- new Page(item,item.parent().wid()); -->
      <!-- }); -->
      new Page(obj,obj.parent().wid());
    }
    function loadSingleTypeCourse(type){
      var data=[];
      var info=getTypeInfo(type);
      getData({
        isFree:1,
        type:info.int
      },"/course/getCourseList",function(d){
        data.appendArray(d);
        getData({
          isFree:0,
          type:info.int
        },"/course/getCourseList",function(d){
          data.appendArray(d);
          J.id(info.type+'List').prev().child(0).txt(info.name+"（共"+data.length+"门）");
          //window[info.type].init([[{isFree:1,courseId:2,name:'aa',imgSrc:'assets/images/sun.png'}]]);
          window[info.type].init(data.group(8));
        },true);
      },true);
    }
    
    function deleteCourse(event,obj){
      stopb(event);
      doubleConfirm("是否确认删除该课程？","请再次确认是否删除该课程？",function(){
        J.show("正在删除...");
        obj.parent(2).fadeOut(function(ele){
          deleteData("/course/"+ele.child(0).txt(),function(){
            J.show("删除成功");
            loadSingleTypeCourse(ele.parent(2).attr("b-loop"));
            ele.remove();
          },true);
        });
      });
    }
    function addCourseMain(type){
      var info=getTypeInfo(type);
      J.jetName("type").val(info.name);
      showAdd("添加"+info.name,"addCourse",function(data,obj){
        J.showWait("正在上传图片...");
        upload(function(src){
          data.imgSrc=src;
          data.type=info.int;
          data.isFree=parseInt(data.isFree);
          J.showWait("正在创建课程...");
          postData(data,"/course",function(d){
            J.show("创建课程成功。");
            loadSingleTypeCourse(type);
            closeAdd();
          },true);
        });
      })
    }
    <!-- function geneCourseMain(data){ -->
      <!-- data.isFree=(data.isFree==0)?"收费课":"公开课"; -->
      <!-- return J.new("div.course-item").clk("J.jump('course_list.html?id="+data.courseId+"')").html('\ -->
          <!-- <div class="course-intro">\ -->
            <!-- <div>类型：'+data.isFree+'</div>\ -->
            <!-- <div>名称：'+data.name+'</div>\ -->
            <!-- <div class="c-btn bg-r" onclick="deleteCourse(event,this)">删除</div>\ -->
          <!-- </div>\ -->
      <!-- ').css("background-image","url('"+data.imgSrc+"')"); -->
    <!-- } -->
    function getTypeInfo(type){
      var info={};
      info.type=type;
      switch(type){
        case 'star':info.int=3;info.name="星星课程";break;
        case 'moon':info.int=2;info.name="月亮课程";break;
        case 'sun':info.int=1;info.name="太阳课程";break;
        case 'other':info.int=4;info.name="自然拼读等专项课程";break;
        default:;break;
      }
      return info;
    }
    </script>
  </body>
</html>
